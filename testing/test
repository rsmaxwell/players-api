#!/bin/bash

#ENDPOINT="https://server.rsmaxwell.co.uk/players-api"
ENDPOINT="http://localhost:4201/players-api"

OPTIONS="--silent --cookie cookie-jar.txt --cookie-jar cookie-jar.txt --dump-header - -k"

#------------------------------------------------------------------
echo "Register"

COMMAND="/register"

cat > data.json <<EOT
{  
    "userID": "007",
    "firstname": "James",
    "lastname": "Bond",
    "email": "james@mi6.co.uk",
    "password": "topsecret"
}
EOT

set -x
curl ${OPTIONS} -X POST ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--data-binary @data.json
set +x

#------------------------------------------------------------------
echo "Login"

COMMAND="/login"
USERID="007"
PASSWORD="topsecret"

set -x
curl ${OPTIONS} -w "%{http_code}\n" -X GET -u "${USERID}:${PASSWORD}" ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--header "Accept: application/json"
set +x

#------------------------------------------------------------------
echo "Register"

COMMAND="/register"

cat > data.json <<EOT
{  
    "userID": "alice",
    "firstname": "Alice",
    "lastname": "Wonderland",
    "email": "alice@abc.com",
    "password": "wonder"
}
EOT

set -x
curl ${OPTIONS} -w "%{http_code}\n" -X POST ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--data-binary @data.json
set +x

#------------------------------------------------------------------
echo "Update Person Role"

COMMAND="/personrole/alice"

cat > data.json <<EOT
{
    "token": "${token}",
    "person": {
        "role": "normal"
    }
}
EOT

set -x
curl ${OPTIONS} -w "%{http_code}\n" -X PUT ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--header "Accept: application/json" \
--data-binary @data.json
set +x

#------------------------------------------------------------------
echo "Read People"

COMMAND="/person"

cat > data.json <<EOT
{
    "token": "${token}",
    "filter": [
        "admin",
        "normal",
        "suspended"
    ]
}
EOT

set -x
curl ${OPTIONS} -w "%{http_code}\n" -X GET ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--header "Accept: application/json" \
--data-binary @data.json
set +x



#------------------------------------------------------------------
echo "Logout"

COMMAND="/logout"

set -x
curl ${OPTIONS} -w "%{http_code}\n" -X GET ${ENDPOINT}${COMMAND} \
--header "Content-Type: application/json" \
--header "Accept: application/json"
set +x

#------------------------------------------------------------------
